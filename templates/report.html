{% extends "base.html" %}

{% block title %}Report for {{ component }}{% endblock %}

{% block content %}
{% if structures %}

<h2>Results</h2>

<ul>
    <li>Number of processed structures: {{ structures|count }} ({{ without_residue }} structures without {{ component }})
    <li>Number of found conformations: {{ total }}
</ul>

<img src="{{ polar_chart }}"/>

<h3>Distribution of conformations based on conformational analysis</h3>

<ul>
    {% for name, count, pc in dir_counts %}
    <li> {{ name }}: {{ count }} ({{ pc|round(2) }}%)</li>
    {% endfor %}
</ul>
<img src="{{ dir_counts_img }}"/>

<h3>Allover percentage of conformations of sugar ring and C4-C5</h3>

<table>
<thead>
<tr>
    <th></th>
    {% for name in dir_names %}
    <th>{{ name }}</th>
    {% endfor %}
</tr>
</thead>
<tbody>
    {% for name, row in sugar_table %}
<tr>
    <td>{{ name }}</td>
    {% for c in row %}
    <td>{{ c|round(2) }}%</td>
    {% endfor %}
</tr>
    {% endfor %}
</table>

<img src="{{ sugar_chart }}"/>

<h3>Percentage within individual conformations</h3>

<table>
<thead>
<tr>
    <th></th>
    {% for name in dir_names %}
    <th>{{ name }}</th>
    {% endfor %}
</tr>
</thead>
<tbody>
    {% for name, row in sugar_rel_table %}
<tr>
    <td>{{ name }}</td>
    {% for c in row %}
    <td>{{ c|round(2) }}%</td>
    {% endfor %}
</tr>
    {% endfor %}
</table>

<img src="{{ sugar_rel_chart }}"/>

<h3>Results by structures</h3>

<table>
<thead>
<tr>
    <th>ID</th>
    <th>Structure Title</th>
    <th>Chain ID</th>
    <th>Macromolecule Name</th>
    <th>EC Numbers</th>
    <th>Gamma</th>
    <th>P</th>
    <th>Gamma (degree)</th>
    <th>P (degree)</th>
    <th>tm (degree)</th>
</tr>
</thead>
<tbody>
    {% for structure, chains in results_by_chains %}
    {% set structure_loop = loop %}
    {% for chain, results in chains %}
    {% set chain_loop = loop %}
    {% for result in results %}
    <tr class="{{ structure_loop.cycle("odd", "even") }}" >
    {% if chain_loop.index == 1 and loop.index == 1 %}
        <td>{{ structure.id }}</td>
        <td title="{{ structure.title }}">{{ structure.title|truncate(40) }}</td>
    {% else %}
        <td class="empty"></td>
        <td class="empty"></td>
    {% endif %}
    {% if loop.index == 1 %}
        <td>{{ chain.id }}</td>
        <td title="{{ chain.compound }}">{{ chain.compound|truncate(40) }}</td>
        <td>{{ chain.ec_numbers_str }}</td>
    {% else %}
        <td class="empty"></td>
        <td class="empty"></td>
        <td class="empty"></td>
    {% endif %}
    <td>{{ result.dir_name }}</td>
    <td>{{ result.gamma_name }}</td>
    <td>{{ result.gamma|round(2) }}&#176;</td>
    <td>{{ result.p|round(2) }}&#176;</td>
    <td>{{ result.tm|round(2) }}&#176;</td>
    </tr>
    {% endfor %}
    {% endfor %}
    {% endfor %}
</table>

<h2>Rejected residues</h2>
{% if rejected %}
{{ rejected|count }} structures were rejected because of the following reasons:
    <table class="redtable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Chain</th>
        <th>Reason</th>
    </tr>
    </thead>
    <tbody>
        {% for row in rejected %}
    <tr>
        <td>{{ row[0] }}</td>
        <td>{{ row[1] }}</td>
        <td>{{ row[2] }}</td>
    </tr>
        {% endfor %}
    </table>
{% else %}
    No residue was rejected from the computation.
{% endif %}

{% else %}
There is no downloaded structure that meets the criteria.
{% endif %}
{% endblock %}
